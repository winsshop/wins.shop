<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</title>
  <link rel="icon" href="data:,">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
      display: flex;
    }
    h1 {
      margin: 20px;
      text-align: center;
      width: 100%;
    }
    #sidebar {
      width: 250px;
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 20px;
      box-shadow: 2px 0 4px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }
    .filter-section {
      margin-bottom: 20px;
    }
    .filter-section h3 {
      margin-bottom: 10px;
      cursor: pointer;
    }
    .filter-options {
      display: none;
      margin-left: 10px;
    }
    .filter-options input[type="checkbox"] {
      margin-right: 5px;
    }
    .selected-filters {
      margin-top: 10px;
      font-size: 12px;
      color: #333;
    }
    .selected-filters span {
      background: #e0e0e0;
      padding: 2px 6px;
      margin: 2px;
      border-radius: 4px;
      display: inline-block;
    }
    .active {
      font-weight: bold;
    }

    #main {
      flex-grow: 1;
      padding: 20px;
    }
    #topbar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 20px;
    }
    #search {
      padding: 8px;
      font-size: 16px;
      width: 300px;
      max-width: 100%;
    }
    #sort {
      padding: 8px;
      font-size: 16px;
    }

    #catalog {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .item {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      width: 220px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      text-align: center;
    }
    .item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 4px;
      background: #f5f5f5;
    }
    .item h3 {
      margin: 10px 0 5px;
    }
    .item p {
      margin: 4px 0;
      font-size: 14px;
    }
    .price {
      font-weight: bold;
      color: #e53935;
    }
    .sizes {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 5px;
      justify-content: center;
    }
    .size {
      padding: 2px 6px;
      background: #f0f0f0;
      border-radius: 3px;
    }
    .loading, .error {
      font-size: 18px;
      padding: 20px;
      width: 100%;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <div class="filter-section">
      <h3 onclick="toggleFilter(this)">–ë—Ä–µ–Ω–¥—ã</h3>
      <div class="filter-options" id="brandFilter"></div>
      <div class="selected-filters" id="selectedBrands"></div>
    </div>
    <div class="filter-section">
      <h3 onclick="toggleFilter(this)">–†–∞–∑–º–µ—Ä—ã</h3>
      <div class="filter-options" id="sizeFilter"></div>
      <div class="selected-filters" id="selectedSizes"></div>
    </div>
    <div class="filter-section">
      <h3 onclick="toggleFilter(this)">–¢–∏–ø—ã</h3>
      <div class="filter-options" id="typeFilter"></div>
      <div class="selected-filters" id="selectedTypes"></div>
    </div>
  </div>

  <div id="main">
    <h1>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</h1>
    <div id="topbar">
      <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
      <select id="sort">
        <option value="default">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
        <option value="price">–ü–æ —Ü–µ–Ω–µ</option>
        <option value="popularity">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
      </select>
    </div>
    <div id="catalog">
      <div class="loading">üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã...</div>
    </div>
  </div>

  <script>
const SHEET_ID_1 = '1Ndf2dPBn0HCO7ADihXMfwv-bNd0FVm56KDFIQmKSnjs'; // –¥–ª–∏–Ω–Ω–∞—è
const SHEET_ID_2 = '1bHwH6KrOZocJ5WRIhISIBwtdHh71-QNKNZohB9PA_Zw'; // –∫–æ—Ä–æ—Ç–∫–∞—è
const API_KEY = 'AIzaSyCLIf11ZJ-MOQvV8XUjzUYbXNXXlgMn8XQ';
const SHEET_NAME = 'TDSheet';

let products = [];
let filteredProducts = [];
let selectedBrands = new Set();
let selectedSizes = new Set();
let selectedTypes = new Set();
let searchQuery = '';
let currentSort = 'default';

const typePriority = ['–ö—Ä–æ—Å—ñ–≤–∫–∏', '–ö–µ–¥–∏', '–ß–µ—Ä–µ–≤–∏–∫–∏'];
const brandPriority = ['Adidas', 'Nike', 'Asics', 'Puma'];

function fetchData() {
  Promise.all([
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_1}/values/${SHEET_NAME}?key=${API_KEY}`)
      .then(res => res.json()),
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_2}/values/${SHEET_NAME}?key=${API_KEY}`)
      .then(res => res.json())
  ])
  .then(([data1, data2]) => {
    const headers1 = data1.values[0];
    const headers2 = data2.values[0];
    const rows1 = data1.values.slice(1);
    const rows2 = data2.values.slice(1);

    const availabilityMap = {};
    rows2.forEach(row => {
      const rowData = Object.fromEntries(row.map((v, i) => [headers2[i], v]));
      if (!availabilityMap[rowData['–ê—Ä—Ç–∏–∫—É–ª']]) availabilityMap[rowData['–ê—Ä—Ç–∏–∫—É–ª']] = [];
      availabilityMap[rowData['–ê—Ä—Ç–∏–∫—É–ª']].push(rowData);
    });

    products = rows1.map(row => {
      const rowData = Object.fromEntries(row.map((v, i) => [headers1[i], v]));
      const art = rowData['–ê—Ä—Ç–∏–∫—É–ª'];
      const name = rowData['–ù–∞–∑–≤–∞'];
      const sizes = (availabilityMap[art] || []).map(r => r['–†–æ–∑–º—ñ—Ä']);
      const price = availabilityMap[art]?.[0]?.['–¶—ñ–Ω–∞'] || '‚Äî';
      const type = rowData['–¢–∏–ø'] || '';
      const brand = rowData['–ë—Ä–µ–Ω–¥'] || '';
      const image = `https://7dreamsport.ua/image/cache/catalog/${art}-500x500.webp`;

      return { art, name, sizes, price: parseFloat(price), brand, type, image };
    });

    renderFilters();
    applyFilters();
  });
}

function renderFilters() {
  const brandSet = new Set(products.map(p => p.brand));
  const sizeSet = new Set(products.flatMap(p => p.sizes));
  const typeSet = new Set(products.map(p => p.type).filter(t => t !== '–í–∑—É—Ç—Ç—è'));

  const brandList = Array.from(brandSet).sort((a, b) => {
    const aP = brandPriority.indexOf(a);
    const bP = brandPriority.indexOf(b);
    return (aP === -1 ? 999 : aP) - (bP === -1 ? 999 : bP);
  });

  const typeList = Array.from(typeSet).sort((a, b) => {
    const aP = typePriority.indexOf(a);
    const bP = typePriority.indexOf(b);
    return (aP === -1 ? 999 : aP) - (bP === -1 ? 999 : bP);
  });

  document.getElementById('brandFilter').innerHTML = brandList.map(b =>
    `<label><input type="checkbox" onchange="toggleBrand('${b}')"> ${b}</label><br>`
  ).join('');

  document.getElementById('typeFilter').innerHTML = typeList.map(t =>
    `<label><input type="checkbox" onchange="toggleType('${t}')"> ${t}</label><br>`
  ).join('');

  document.getElementById('sizeFilter').innerHTML = Array.from(sizeSet).sort().map(s =>
    `<label><input type="checkbox" onchange="toggleSize('${s}')"> ${s}</label><br>`
  ).join('');
}

function toggleBrand(brand) {
  selectedBrands.has(brand) ? selectedBrands.delete(brand) : selectedBrands.add(brand);
  updateSelected('selectedBrands', selectedBrands);
  applyFilters();
}

function toggleSize(size) {
  selectedSizes.has(size) ? selectedSizes.delete(size) : selectedSizes.add(size);
  updateSelected('selectedSizes', selectedSizes);
  applyFilters();
}

function toggleType(type) {
  selectedTypes.has(type) ? selectedTypes.delete(type) : selectedTypes.add(type);
  updateSelected('selectedTypes', selectedTypes);
  applyFilters();
}

function updateSelected(id, set) {
  document.getElementById(id).innerHTML = Array.from(set).map(s => `<span>${s}</span>`).join('');
}

function applyFilters() {
  filteredProducts = products.filter(p =>
    (selectedBrands.size === 0 || selectedBrands.has(p.brand)) &&
    (selectedSizes.size === 0 || p.sizes.some(s => selectedSizes.has(s))) &&
    (selectedTypes.size === 0 || selectedTypes.has(p.type)) &&
    (p.name.toLowerCase().includes(searchQuery.toLowerCase()))
  );
  sortProducts();
  renderProducts();
}

function sortProducts() {
  if (currentSort === 'price') {
    filteredProducts.sort((a, b) => a.price - b.price);
  } else if (currentSort === 'popularity') {
    filteredProducts.sort((a, b) => b.sizes.length - a.sizes.length);
  } else {
    filteredProducts.sort((a, b) => {
      const aP = typePriority.indexOf(a.type);
      const bP = typePriority.indexOf(b.type);
      return (aP === -1 ? 999 : aP) - (bP === -1 ? 999 : bP);
    });
  }
}

function renderProducts() {
  const catalog = document.getElementById('catalog');
  catalog.innerHTML = filteredProducts.length ? '' : '<div class="error">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º üò¢</div>';
  filteredProducts.forEach(p => {
    const item = document.createElement('div');
    item.className = 'item';
    item.innerHTML = `
      <img src="${p.image}" onerror="this.src='https://via.placeholder.com/220x150?text=No+Image'">
      <h3>${p.name}</h3>
      <p>–ë—Ä–µ–Ω–¥: ${p.brand}</p>
      <p>–¢–∏–ø: ${p.type}</p>
      <p class="price">${p.price ? p.price + ' –≥—Ä–Ω' : '‚Äî'}</p>
      <div class="sizes">${p.sizes.map(s => `<span class="size">${s}</span>`).join('')}</div>
    `;
    catalog.appendChild(item);
  });
}

document.getElementById('search').addEventListener('input', e => {
  searchQuery = e.target.value;
  applyFilters();
});

document.getElementById('sort').addEventListener('change', e => {
  currentSort = e.target.value;
  applyFilters();
});

function toggleFilter(h3) {
  const div = h3.nextElementSibling;
  div.style.display = div.style.display === 'block' ? 'none' : 'block';
}

fetchData();

  </script>
</body>
</html>
