<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Каталог кроссовок</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --primary-color: #3f51b5;
      --secondary-color: #f50057;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #757575;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --radius: 8px;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--light-gray);
      display: flex;
      color: #333;
      min-height: 100vh;
    }
    
    .sidebar {
      width: 280px;
      background: white;
      border-right: 1px solid var(--medium-gray);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      flex-shrink: 0; /* Этот параметр не позволит меню сжиматься */
    }
    
    .sidebar-header {
      padding: 20px;
      background: var(--primary-color);
      color: white;
    }
    
    .sidebar-header h2 {
      margin: 0;
      font-size: 22px;
      font-weight: 500;
    }
    
    .filter-section {
      margin-bottom: 10px;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .filter-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .filter-title:hover {
      background-color: rgba(63, 81, 181, 0.05);
    }
    
    .filter-title::after {
      content: '▼';
      font-size: 12px;
      transition: transform 0.3s;
    }
    
    .filter-title.collapsed::after {
      transform: rotate(-90deg);
    }
    
    .filter-content {
      max-height: 300px;
      overflow-y: auto;
      padding: 0 20px 15px;
      transition: max-height 0.3s ease;
    }
    
    .filter-content.collapsed {
      max-height: 0;
      overflow: hidden;
      padding-top: 0;
      padding-bottom: 0;
    }
    
    .filter-section label {
      display: flex;
      align-items: center;
      margin: 8px 0;
      cursor: pointer;
    }
    
    .filter-section input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
      width: 16px;
      height: 16px;
    }
    
    .size-standard-select {
      margin: 0 0 15px;
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--medium-gray);
    }
    
    .main-content {
      flex-grow: 1;
      padding: 30px;
      min-width: 0; /* Важно для корректного flex-отображения */
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      margin: 0 0 20px;
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }
    
    #searchInput {
      width: 100%;
      max-width: 500px;
      padding: 12px 15px;
      font-size: 16px;
      border: 1px solid var(--medium-gray);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s;
    }
    
    #searchInput:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
    }
    
    #catalog {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      justify-content: center;
    }
    
    .item {
      background: white;
      border-radius: var(--radius);
      width: 260px;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      overflow: hidden;
    }
    
    .item:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .item-img-container {
      height: 180px;
      overflow: hidden;
      position: relative;
    }
    
    .item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    
    .item:hover img {
      transform: scale(1.05);
    }
    
    .item-content {
      padding: 15px;
    }
    
    .item h3 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #333;
      line-height: 1.3;
    }
    
    .item-info {
      margin: 5px 0;
      font-size: 14px;
      display: flex;
    }
    
    .item-info strong {
      width: 75px;
      color: var(--dark-gray);
    }
    
    .sizes {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    
    .size {
      padding: 3px 7px;
      background: var(--light-gray);
      border-radius: 3px;
      font-size: 12px;
    }
    
    .price {
      margin-top: 15px;
      font-weight: bold;
      color: var(--secondary-color);
      font-size: 18px;
    }
    
    .loading, .error {
      font-size: 18px;
      padding: 40px;
      width: 100%;
      text-align: center;
      color: var(--dark-gray);
    }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(63, 81, 181, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .sizes-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }
    
    .sizes-grid label {
      display: block;
      text-align: center;
      margin: 0;
    }
    
    .counter {
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .popular-brand {
      font-weight: 500;
    }
    
    /* Стили для таблицы размеров */
    .size-table-toggle {
      color: var(--primary-color);
      text-decoration: underline;
      cursor: pointer;
      display: block;
      margin-top: 5px;
      font-size: 12px;
    }
    
    .size-chart-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .size-chart {
      background: white;
      padding: 20px;
      border-radius: var(--radius);
      max-width: 90%;
      max-height: 90%;
      overflow: auto;
      position: relative;
    }
    
    .size-chart-close {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 24px;
      color: var(--dark-gray);
    }
    
    .size-chart table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }
    
    .size-chart table th, .size-chart table td {
      border: 1px solid var(--medium-gray);
      padding: 8px;
      text-align: center;
    }
    
    .size-chart table th {
      background-color: var(--light-gray);
    }
    
    /* Стили для мобильной версии */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 50vh;
        position: relative;
      }
      
      .sidebar-header {
        padding: 15px;
      }
      
      .main-content {
        padding: 20px 15px;
      }
      
      .item {
        width: 100%;
        max-width: 300px;
      }
      
      .size-chart {
        max-width: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Фильтры</h2>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        Бренды <span id="brandCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="brandContainer">
        <div id="brandFilters"></div>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        Размеры <span id="sizeCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="sizeContainer">
        <select id="sizeStandard" class="size-standard-select" onchange="changeSizeStandard()">
          <option value="EU" selected>EU</option>
          <option value="US">US</option>
          <option value="UK">UK</option>
          <option value="UA">UA</option>
          <option value="CM">CM</option>
        </select>
        <div class="sizes-grid" id="sizeFilters"></div>
        <a class="size-table-toggle" onclick="toggleSizeChart()">Показать таблицу размеров</a>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        Типы <span id="typeCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="typeContainer">
        <div id="typeFilters"></div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>Каталог кроссовок</h1>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Поиск по названию...">
      </div>
    </div>
    <div id="catalog">
      <div class="loading">
        <div class="loading-spinner"></div>
        Загружаем товары...
      </div>
    </div>
  </div>
  
  <div class="size-chart-container" id="sizeChartContainer">
    <div class="size-chart">
      <div class="size-chart-close" onclick="toggleSizeChart()">×</div>
      <h3>Таблица соответствия размеров обуви</h3>
      <p>Выберите бренд для отображения специфической таблицы размеров:</p>
      <select id="brandSizeSelect" onchange="updateSizeChart()">
        <option value="general">Общая таблица</option>
        <option value="nike">Nike</option>
        <option value="adidas">Adidas</option>
        <option value="newbalance">New Balance</option>
        <option value="puma">Puma</option>
        <option value="reebok">Reebok</option>
        <option value="asics">Asics</option>
        <option value="converse">Converse</option>
        <option value="vans">Vans</option>
      </select>
      <div id="sizeChartTable"></div>
    </div>
  </div>
  <script>
    const API_KEY = "AIzaSyCLIf11ZJ-MOQvV8XUjzUYbXNXXlgMn8XQ";
    const SHEET_ID_SHORT = "1cO0HPxLVgYbc0TayeF6dJf0Z1G8aRqwuK56mXMnKk5U";
    const SHEET_ID_LONG = "1ZUdfEr8ztkJnUWpj7j0H8MvrMRLVt0Fo2NI71KvCmgs";
    const IMAGE_PROXY = "https://images.weserv.nl/?url=";

    const FILTER_CONFIG = {
      excludedBrands: ["Joma"],
      excludedKeywords: [
        "М'яч", "Пуховик", "плавки", "ракетка",
        "футболка", "чохол", "шкарпетки", "шорти",
        "штани", "боксерки", "гетри", "кофта",
        "Аквашузи", "Бутси", "Шльопанці", "Шиповки",
        "Футзалки", "Сороконіжки", "Сандалі", "Коралки", "Крокси", "В'єтнамки", "Дитячі", 
      ],
      typePriority: {
        'Кросівки': 1,
        'Кеди': 2,
        'Черевики': 3,
        'Крокси': 4,
        'default': 10
      },
      popularBrands: [
        "Nike", "Adidas", "Puma", "New Balance", "Reebok", 
        "Asics", "Under Armour", "Converse", "Vans", "Jordan"
      ]
    };

    // Таблицы соответствия размеров для разных брендов
    const SIZE_CHARTS = {
      general: {
        EU: [35, 35.5, 36, 37, 37.5, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 46, 47, 48, 49],
        US: [3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 13, 14, 15],
        UK: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12.5, 13.5, 14.5],
        UA: [35, 36, 36, 37, 38, 38, 39, 39, 40, 41, 41, 42, 43, 43, 44, 45, 45, 46, 47, 48, 49],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 32, 33, 34]
      },
      nike: {
        EU: [35.5, 36, 36.5, 37.5, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 45.5, 46, 47, 47.5, 48.5],
        US: [3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 14],
        UK: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13.5],
        UA: [35.5, 36, 36.5, 37.5, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 45.5, 46, 47, 47.5, 48.5],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 31.5, 32, 33]
      },
      adidas: {
        EU: [36, 36.5, 37.5, 38, 38.5, 39.5, 40, 40.5, 41.5, 42, 42.5, 43.5, 44, 44.5, 45.5, 46, 46.5, 47.5, 48, 48.5, 49.5],
        US: [4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 13.5, 14],
        UK: [3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 13.5],
        UA: [36, 36.5, 37.5, 38, 38.5, 39.5, 40, 40.5, 41.5, 42, 42.5, 43.5, 44, 44.5, 45.5, 46, 46.5, 47.5, 48, 48.5, 49.5],
        CM: [22.8, 23.1, 23.8, 24.2, 24.6, 25.1, 25.5, 25.9, 26.6, 27, 27.5, 28.1, 28.5, 29, 29.6, 30, 30.5, 31.1, 31.5, 32, 32.6]
      },
      newbalance: {
        EU: [35, 35.5, 36, 37, 37.5, 38, 38.5, 39, 40, 40.5, 41.5, 42, 42.5, 43, 44, 44.5, 45, 46.5, 47.5, 49.5, 50],
        US: [4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 13, 14, 15, 15.5],
        UK: [2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11.5, 12.5, 14, 14.5],
        UA: [35, 35.5, 36, 37, 37.5, 38, 38.5, 39, 40, 40.5, 41.5, 42, 42.5, 43, 44, 44.5, 45, 46.5, 47.5, 49.5, 50],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31.5, 32.5, 34, 34.5]
      },
      puma: {
        EU: [35.5, 36, 37, 37.5, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 46, 47, 48.5, 49.5, 50.5],
        US: [3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 13, 14, 15],
        UK: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 13, 14, 15],
        UA: [35.5, 36, 37, 37.5, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 46, 47, 48.5, 49.5, 50.5],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 32, 33, 34]
      },
      reebok: {
        EU: [35.5, 36, 36.5, 37, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 45.5, 46, 47, 48, 49],
        US: [4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 14, 15],
        UK: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 13, 14],
        UA: [35.5, 36, 36.5, 37, 38, 38.5, 39, 40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 45.5, 46, 47, 48, 49],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 32, 33, 34]
      },
      asics: {
        EU: [36, 37, 37.5, 38, 39, 39.5, 40, 40.5, 41.5, 42, 42.5, 43.5, 44, 44.5, 45, 46, 46.5, 47, 48, 49, 50],
        US: [4, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 14, 15, 16],
        UK: [3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 13, 14, 15],
        UA: [36, 37, 37.5, 38, 39, 39.5, 40, 40.5, 41.5, 42, 42.5, 43.5, 44, 44.5, 45, 46, 46.5, 47, 48, 49, 50],
        CM: [22.9, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 31.5, 32.5, 33.5, 34.5]
      },
      converse: {
        EU: [35.5, 36, 37, 37.5, 38, 39, 39.5, 40, 41, 41.5, 42, 42.5, 43, 44, 44.5, 45, 46, 47, 48, 49, 50],
        US: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 12, 13, 14, 15],
        UK: [3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 12, 13, 14, 15],
        UA: [35.5, 36, 37, 37.5, 38, 39, 39.5, 40, 41, 41.5, 42, 42.5, 43, 44, 44.5, 45, 46, 47, 48, 49, 50],
        CM: [22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31.5, 32.5, 33.5, 34.5]
      },
vans: {
        EU: [34.5, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 44.5, 45, 46, 47, 48, 49, 50],
        US: [3.5, 4, 5, 5.5, 6, 7, 7.5, 8.5, 9, 10, 10.5, 11, 11.5, 12, 13, 14, 15, 16],
        UK: [2.5, 3, 4, 4.5, 5, 6, 6.5, 7.5, 8, 9, 9.5, 10, 10.5, 11, 12, 13, 14, 15],
        UA: [34.5, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 44.5, 45, 46, 47, 48, 49, 50],
        CM: [22, 22.5, 23, 23.5, 24, 25, 25.5, 26.5, 27, 28, 28.5, 29, 29.5, 30, 31, 32, 33, 34]
      }
    };
    
    // Глобальные переменные
    let products = [];
    let filteredProducts = [];
    let currentSizeStandard = "EU";
    let availableSizes = new Set();
    let selectedSizes = new Set();
    let availableBrands = new Set();
    let selectedBrands = new Set();
    let availableTypes = new Set();
    let selectedTypes = new Set();

    // Инициализация страницы
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    // Инициализация приложения
    async function initializeApp() {
      try {
        products = await fetchProducts();
        initializeFilters();
        updateProductList();
        
        // Добавление обработчиков событий
        document.getElementById('searchInput').addEventListener('input', updateProductList);
      } catch (error) {
        showError(error.message);
      }
    }

    // Загрузка данных из Google Sheets
    async function fetchProducts() {
      try {
        // Получаем данные из двух источников и объединяем
        const productsShort = await fetchSheetData(SHEET_ID_SHORT);
        const productsLong = await fetchSheetData(SHEET_ID_LONG);
        
        // Объединяем и обрабатываем данные
        let allProducts = [...productsShort, ...productsLong];
        
        // Обработка данных
        allProducts = allProducts.filter(product => {
          // Фильтруем по брендам и ключевым словам
          if (FILTER_CONFIG.excludedBrands.includes(product.brand)) return false;
          
          // Проверяем исключаемые ключевые слова в названии
          for (const keyword of FILTER_CONFIG.excludedKeywords) {
            if (product.name.includes(keyword)) return false;
          }
          
          return true;
        });
        
        return allProducts;
      } catch (error) {
        throw new Error(`Ошибка загрузки данных: ${error.message}`);
      }
    }

    // Загрузка данных из конкретного источника
    async function fetchSheetData(sheetId) {
      try {
        const response = await fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1?key=${API_KEY}`
        );
        
        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }
        
        const data = await response.json();
        const rows = data.values;
        
        // Предполагаем, что первая строка содержит заголовки
        const headers = rows[0];
        return rows.slice(1).map(row => {
          const product = {};
          headers.forEach((header, index) => {
            product[header.toLowerCase()] = row[index] || '';
          });
          
          // Обработка размеров
          if (product.sizes) {
            product.sizeArray = product.sizes.split(',')
              .map(size => parseFloat(size.trim()))
              .filter(size => !isNaN(size));
          } else {
            product.sizeArray = [];
          }
          
          return product;
        });
      } catch (error) {
        throw new Error(`Ошибка загрузки данных из таблицы: ${error.message}`);
      }
    }
// Инициализация фильтров
    function initializeFilters() {
      // Собираем все доступные данные для фильтров
      products.forEach(product => {
        // Добавляем бренд
        if (product.brand) {
          availableBrands.add(product.brand.trim());
        }
        
        // Добавляем тип
        if (product.type) {
          availableTypes.add(product.type.trim());
        }
        
        // Добавляем размеры
        product.sizeArray.forEach(size => {
          availableSizes.add(size);
        });
      });
      
      // Инициализируем фильтры
      renderBrandFilters();
      renderTypeFilters();
      renderSizeFilters();
      
      // Добавляем обработчики событий для открытия/закрытия фильтров
      const filterTitles = document.querySelectorAll('.filter-title');
      filterTitles.forEach(title => {
        title.addEventListener('click', () => toggleFilter(title));
      });
    }
    
    // Переключение видимости фильтра
    function toggleFilter(element) {
      const content = element.nextElementSibling;
      element.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    }
    
    // Отображение фильтров брендов
    function renderBrandFilters() {
      const container = document.getElementById('brandFilters');
      container.innerHTML = '';
      
      // Сортируем бренды по приоритету (популярные сначала, затем алфавитный порядок)
      const sortedBrands = Array.from(availableBrands).sort((a, b) => {
        const aIsPopular = FILTER_CONFIG.popularBrands.includes(a);
        const bIsPopular = FILTER_CONFIG.popularBrands.includes(b);
        
        if (aIsPopular && !bIsPopular) return -1;
        if (!aIsPopular && bIsPopular) return 1;
        return a.localeCompare(b);
      });
      
      sortedBrands.forEach(brand => {
        const count = products.filter(p => p.brand === brand).length;
        const label = document.createElement('label');
        const isPopular = FILTER_CONFIG.popularBrands.includes(brand);
        
        label.innerHTML = `
          <input type="checkbox" data-brand="${brand}" 
            ${selectedBrands.has(brand) ? 'checked' : ''} 
            onchange="toggleBrandFilter(this)">
          <span ${isPopular ? 'class="popular-brand"' : ''}>${brand}</span> (${count})
        `;
        
        container.appendChild(label);
      });
      
      updateBrandCounter();
    }
    
    // Отображение фильтров типов товаров
    function renderTypeFilters() {
      const container = document.getElementById('typeFilters');
      container.innerHTML = '';
      
      // Сортируем типы по приоритету
      const sortedTypes = Array.from(availableTypes).sort((a, b) => {
        const aPriority = FILTER_CONFIG.typePriority[a] || FILTER_CONFIG.typePriority.default;
        const bPriority = FILTER_CONFIG.typePriority[b] || FILTER_CONFIG.typePriority.default;
        
        if (aPriority !== bPriority) {
          return aPriority - bPriority;
        }
        
        return a.localeCompare(b);
      });
      
      sortedTypes.forEach(type => {
        const count = products.filter(p => p.type === type).length;
        const label = document.createElement('label');
        
        label.innerHTML = `
          <input type="checkbox" data-type="${type}" 
            ${selectedTypes.has(type) ? 'checked' : ''} 
            onchange="toggleTypeFilter(this)">
          <span>${type}</span> (${count})
        `;
        
        container.appendChild(label);
      });
      
      updateTypeCounter();
    }
    
    // Отображение фильтров размеров
    function renderSizeFilters() {
      const container = document.getElementById('sizeFilters');
      container.innerHTML = '';
      
      // Получаем размеры в соответствии с выбранным стандартом
      const standardSizes = getAvailableSizesInStandard(currentSizeStandard);
      
      // Сортируем размеры по возрастанию
      const sortedSizes = Array.from(standardSizes).sort((a, b) => a - b);
      
      sortedSizes.forEach(size => {
        // Преобразуем размер в EU для внутреннего хранения
        const euSize = convertSizeToEU(size, currentSizeStandard);
        
        const label = document.createElement('label');
        label.innerHTML = `
          <input type="checkbox" data-size="${euSize}" 
            ${selectedSizes.has(euSize) ? 'checked' : ''} 
            onchange="toggleSizeFilter(this)">
          ${size.toString().replace('.', ',')}
        `;
        
        container.appendChild(label);
      });
      
      updateSizeCounter();
    }
    
    // Получение доступных размеров в выбранном стандарте
    function getAvailableSizesInStandard(standard) {
      const standardSizes = new Set();
      
      // Преобразуем все доступные EU размеры в выбранный стандарт
      availableSizes.forEach(euSize => {
        const convertedSize = convertSize(euSize, "EU", standard);
        if (convertedSize !== null) {
          standardSizes.add(convertedSize);
        }
      });
      
      return standardSizes;
    }
    
    // Смена стандарта размеров
    function changeSizeStandard() {
      const select = document.getElementById('sizeStandard');
      currentSizeStandard = select.value;
      
      // Перерисовываем фильтры с новым стандартом
      renderSizeFilters();
      
      // Обновляем отображение товаров с новым стандартом размеров
      updateProductList();
    }
    
    // Конвертация размера из одного стандарта в другой
    function convertSize(size, fromStandard, toStandard) {
      if (fromStandard === toStandard) return size;
      
      const brandChart = SIZE_CHARTS.general; // Используем общую таблицу размеров
      
      // Находим ближайший индекс для исходного размера
      const fromSizes = brandChart[fromStandard];
      let closestIndex = -1;
      let minDiff = Infinity;
      
      for (let i = 0; i < fromSizes.length; i++) {
        const diff = Math.abs(fromSizes[i] - size);
        if (diff < minDiff) {
          minDiff = diff;
          closestIndex = i;
        }
      }
      
      // Проверка на слишком большое расхождение
      if (minDiff > 0.5) {
        return null; // Не удалось найти соответствие
      }
      
      // Возвращаем соответствующий размер в целевом стандарте
      return brandChart[toStandard][closestIndex];
    }
    
    // Преобразование любого размера в EU (для внутреннего хранения)
    function convertSizeToEU(size, fromStandard) {
      return convertSize(size, fromStandard, "EU");
    }
    
    // Преобразование EU размера в любой другой стандарт
    function convertSizeFromEU(euSize, toStandard) {
      return convertSize(euSize, "EU", toStandard);
    }
    
    // Переключение фильтра бренда
    function toggleBrandFilter(checkbox) {
      const brand = checkbox.dataset.brand;
      
      if (checkbox.checked) {
        selectedBrands.add(brand);
      } else {
        selectedBrands.delete(brand);
      }
      
      updateBrandCounter();
      updateProductList();
    }
    
    // Переключение фильтра типа
    function toggleTypeFilter(checkbox) {
      const type = checkbox.dataset.type;
      
      if (checkbox.checked) {
        selectedTypes.add(type);
      } else {
        selectedTypes.delete(type);
      }
      
      updateTypeCounter();
      updateProductList();
    }
    
    // Переключение фильтра размера
    function toggleSizeFilter(checkbox) {
      const size = parseFloat(checkbox.dataset.size);
      
      if (checkbox.checked) {
        selectedSizes.add(size);
      } else {
        selectedSizes.delete(size);
      }
      
      updateSizeCounter();
      updateProductList();
    }
    
    // Обновление счетчика выбранных брендов
    function updateBrandCounter() {
      document.getElementById('brandCounter').textContent = selectedBrands.size;
    }
    
    // Обновление счетчика выбранных типов
    function updateTypeCounter() {
      document.getElementById('typeCounter').textContent = selectedTypes.size;
    }
    
    // Обновление счетчика выбранных размеров
    function updateSizeCounter() {
      document.getElementById('sizeCounter').textContent = selectedSizes.size;
    }
// Обновление списка товаров на основе фильтров
    function updateProductList() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      // Применяем фильтры
      filteredProducts = products.filter(product => {
        // Фильтр по поисковому запросу
        if (searchTerm && !product.name.toLowerCase().includes(searchTerm)) {
          return false;
        }
        
        // Фильтр по брендам (если выбраны)
        if (selectedBrands.size > 0 && !selectedBrands.has(product.brand)) {
          return false;
        }
        
        // Фильтр по типам (если выбраны)
        if (selectedTypes.size > 0 && !selectedTypes.has(product.type)) {
          return false;
        }
        
        // Фильтр по размерам (если выбраны)
        if (selectedSizes.size > 0) {
          // Проверяем, есть ли у товара хотя бы один выбранный размер
          const hasSizes = product.sizeArray.some(size => selectedSizes.has(size));
          if (!hasSizes) {
            return false;
          }
        }
        
        return true;
      });
      
      renderProducts(filteredProducts);
    }
    
    // Отображение товаров
    function renderProducts(products) {
      const container = document.getElementById('catalog');
      container.innerHTML = '';
      
      if (products.length === 0) {
        container.innerHTML = '<div class="error">Нет товаров, соответствующих выбранным фильтрам</div>';
        return;
      }
      
      products.forEach(product => {
        const item = document.createElement('div');
        item.className = 'item';
        
        // Преобразуем размеры в выбранный стандарт для отображения
        const displaySizes = product.sizeArray
          .map(euSize => convertSizeFromEU(euSize, currentSizeStandard))
          .filter(size => size !== null) // Удаляем null значения
          .sort((a, b) => a - b); // Сортируем по возрастанию
        
        // Форматируем отображение размеров
        const sizeDisplay = displaySizes.map(size => {
          return `<span class="size">${size.toString().replace('.', ',')}</span>`;
        }).join('');
        
        // Обрабатываем изображение
        let imageUrl = product.image || '';
        if (imageUrl && !imageUrl.startsWith('https://') && !imageUrl.startsWith('http://')) {
          imageUrl = `https://${imageUrl}`;
        }
        
        // Добавляем прокси для изображений, чтобы избежать CORS-ошибок
        if (imageUrl) {
          imageUrl = `${IMAGE_PROXY}${encodeURIComponent(imageUrl)}`;
        }
        
        item.innerHTML = `
          <div class="item-img-container">
            <img src="${imageUrl || 'placeholder.jpg'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/300x200?text=Нет+изображения'">
          </div>
          <div class="item-content">
            <h3>${product.name}</h3>
            <div class="item-info"><strong>Бренд:</strong> ${product.brand}</div>
            <div class="item-info"><strong>Тип:</strong> ${product.type || 'Не указан'}</div>
            <div class="item-info"><strong>Размеры (${currentSizeStandard}):</strong></div>
            <div class="sizes">${sizeDisplay}</div>
            <div class="price">${product.price ? product.price + ' грн' : 'Цена по запросу'}</div>
          </div>
        `;
        
        container.appendChild(item);
      });
    }
    
    // Показать ошибку
    function showError(message) {
      const container = document.getElementById('catalog');
      container.innerHTML = `<div class="error">Ошибка: ${message}</div>`;
    }
    
    // Отображение/скрытие таблицы размеров
    function toggleSizeChart() {
      const container = document.getElementById('sizeChartContainer');
      if (container.style.display === 'flex') {
        container.style.display = 'none';
      } else {
        container.style.display = 'flex';
        updateSizeChart(); // Обновляем таблицу при открытии
      }
    }
    
    // Обновление таблицы размеров
    function updateSizeChart() {
      const brandSelect = document.getElementById('brandSizeSelect');
      const selectedBrand = brandSelect.value;
      const container = document.getElementById('sizeChartTable');
      
      // Получаем таблицу размеров для выбранного бренда
      const sizeChart = SIZE_CHARTS[selectedBrand] || SIZE_CHARTS.general;
      
      // Создаем HTML для таблицы
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>EU</th>
              <th>US</th>
              <th>UK</th>
              <th>UA</th>
              <th>CM</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      // Добавляем строки таблицы
      for (let i = 0; i < sizeChart.EU.length; i++) {
        tableHTML += `
          <tr>
            <td>${sizeChart.EU[i]}</td>
            <td>${sizeChart.US[i] || '-'}</td>
            <td>${sizeChart.UK[i] || '-'}</td>
            <td>${sizeChart.UA[i] || '-'}</td>
            <td>${sizeChart.CM[i] || '-'}</td>
          </tr>
        `;
      }
      
      tableHTML += `
          </tbody>
        </table>
      `;
      
      container.innerHTML = tableHTML;
    }
  </script>
</body>
</html>
