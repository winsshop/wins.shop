<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --primary-color: #3f51b5;
      --secondary-color: #f50057;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #757575;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --radius: 8px;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--light-gray);
      display: flex;
      color: #333;
      min-height: 100vh;
    }
    
    .sidebar {
      width: 280px;
      background: white;
      border-right: 1px solid var(--medium-gray);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      flex-shrink: 0; /* –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –º–µ–Ω—é —Å–∂–∏–º–∞—Ç—å—Å—è */
    }
    
    .sidebar-header {
      padding: 20px;
      background: var(--primary-color);
      color: white;
    }
    
    .sidebar-header h2 {
      margin: 0;
      font-size: 22px;
      font-weight: 500;
    }
    
    .filter-section {
      margin-bottom: 10px;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .filter-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .filter-title:hover {
      background-color: rgba(63, 81, 181, 0.05);
    }
    
    .filter-title::after {
      content: '‚ñº';
      font-size: 12px;
      transition: transform 0.3s;
    }
    
    .filter-title.collapsed::after {
      transform: rotate(-90deg);
    }
    
    .filter-content {
      max-height: 300px;
      overflow-y: auto;
      padding: 0 20px 15px;
      transition: max-height 0.3s ease;
    }
    
    .filter-content.collapsed {
      max-height: 0;
      overflow: hidden;
      padding-top: 0;
      padding-bottom: 0;
    }
    
    .filter-section label {
      display: flex;
      align-items: center;
      margin: 8px 0;
      cursor: pointer;
    }
    
    .filter-section input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
      width: 16px;
      height: 16px;
    }
    
    .main-content {
      flex-grow: 1;
      padding: 30px;
      min-width: 0; /* –í–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ flex-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      margin: 0 0 20px;
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }
    
    #searchInput {
      width: 100%;
      max-width: 500px;
      padding: 12px 15px;
      font-size: 16px;
      border: 1px solid var(--medium-gray);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s;
    }
    
    #searchInput:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
    }
    
    #catalog {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      justify-content: center;
    }
    
    .item {
      background: white;
      border-radius: var(--radius);
      width: 260px;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      overflow: hidden;
    }
    
    .item:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .item-img-container {
      height: 180px;
      overflow: hidden;
      position: relative;
    }
    
    .item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    
    .item:hover img {
      transform: scale(1.05);
    }
    
    .item-content {
      padding: 15px;
    }
    
    .item h3 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #333;
      line-height: 1.3;
    }
    
    .item-info {
      margin: 5px 0;
      font-size: 14px;
      display: flex;
    }
    
    .item-info strong {
      width: 75px;
      color: var(--dark-gray);
    }
    
    .sizes {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    
    .size {
      padding: 3px 7px;
      background: var(--light-gray);
      border-radius: 3px;
      font-size: 12px;
    }
    
    .price {
      margin-top: 15px;
      font-weight: bold;
      color: var(--secondary-color);
      font-size: 18px;
    }
    
    .loading, .error {
      font-size: 18px;
      padding: 40px;
      width: 100%;
      text-align: center;
      color: var(--dark-gray);
    }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(63, 81, 181, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .sizes-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }
    
    .sizes-grid label {
      display: block;
      text-align: center;
      margin: 0;
    }
    
    .counter {
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .popular-brand {
      font-weight: 500;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
    .pagination-container {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .pagination-info {
      font-size: 14px;
      color: var(--dark-gray);
    }

    .pagination {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .pagination button {
      width: 40px;
      height: 40px;
      border-radius: var(--radius);
      border: 1px solid var(--medium-gray);
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 14px;
    }

    .pagination button:hover {
      background: var(--light-gray);
    }

    .pagination button.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-arrow {
      font-size: 18px;
      line-height: 1;
    }

    .items-per-page {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .items-per-page select {
      padding: 5px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--medium-gray);
      background: white;
      cursor: pointer;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 50vh;
        position: relative;
      }
      
      .sidebar-header {
        padding: 15px;
      }
      
      .main-content {
        padding: 20px 15px;
      }
      
      .item {
        width: 100%;
        max-width: 300px;
      }

      .pagination button {
        width: 35px;
        height: 35px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>–§–∏–ª—å—Ç—Ä—ã</h2>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        –ë—Ä–µ–Ω–¥—ã <span id="brandCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="brandContainer">
        <div id="brandFilters"></div>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        –†–∞–∑–º–µ—Ä—ã <span id="sizeCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="sizeContainer">
        <div class="sizes-grid" id="sizeFilters"></div>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-title" onclick="toggleFilter(this)">
        –¢–∏–ø—ã <span id="typeCounter" class="counter">0</span>
      </div>
      <div class="filter-content" id="typeContainer">
        <div id="typeFilters"></div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</h1>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
      </div>
    </div>
    <div id="catalog">
      <div class="loading">
        <div class="loading-spinner"></div>
        –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã...
      </div>
    </div>
    <div class="pagination-container">
      <div class="items-per-page">
        <label for="itemsPerPage">–¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
        <select id="itemsPerPage">
          <option value="12">12</option>
          <option value="24" selected>24</option>
          <option value="48">48</option>
          <option value="96">96</option>
        </select>
      </div>
      <div class="pagination-info" id="paginationInfo">
        –ü–æ–∫–∞–∑–∞–Ω–æ 0 –∏–∑ 0 —Ç–æ–≤–∞—Ä–æ–≤
      </div>
      <div class="pagination" id="pagination">
        <!-- –ö–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
      </div>
    </div>
  </div>

  <script>
    const API_KEY = "AIzaSyCLIf11ZJ-MOQvV8XUjzUYbXNXXlgMn8XQ";
    const SHEET_ID_SHORT = "1cO0HPxLVgYbc0TayeF6dJf0Z1G8aRqwuK56mXMnKk5U";
    const SHEET_ID_LONG = "1ZUdfEr8ztkJnUWpj7j0H8MvrMRLVt0Fo2NI71KvCmgs";
    const IMAGE_PROXY = "https://images.weserv.nl/?url=";

    const MIN_SIZE = 35.5; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

    const FILTER_CONFIG = {
      excludedBrands: ["Joma"],
      excludedKeywords: [
        "–ú'—è—á", "–ü—É—Ö–æ–≤–∏–∫", "–ø–ª–∞–≤–∫–∏", "—Ä–∞–∫–µ—Ç–∫–∞",
        "—Ñ—É—Ç–±–æ–ª–∫–∞", "—á–æ—Ö–æ–ª", "—à–∫–∞—Ä–ø–µ—Ç–∫–∏", "—à–æ—Ä—Ç–∏",
        "—à—Ç–∞–Ω–∏", "–±–æ–∫—Å–µ—Ä–∫–∏", "–≥–µ—Ç—Ä–∏", "–∫–æ—Ñ—Ç–∞",
        "–ê–∫–≤–∞—à—É–∑–∏", "–ë—É—Ç—Å–∏", "–®–ª—å–æ–ø–∞–Ω—Ü—ñ", "–®–∏–ø–æ–≤–∫–∏",
        "–§—É—Ç–∑–∞–ª–∫–∏", "–°–æ—Ä–æ–∫–æ–Ω—ñ–∂–∫–∏", "–°–∞–Ω–¥–∞–ª—ñ", "–ö–æ—Ä–∞–ª–∫–∏", "–ö—Ä–æ–∫—Å–∏", "–í'—î—Ç–Ω–∞–º–∫–∏", "–î–∏—Ç—è—á—ñ", 
      ],
      typePriority: {
        '–ö—Ä–æ—Å—ñ–≤–∫–∏': 1,
        '–ö–µ–¥–∏': 2,
        '–ß–µ—Ä–µ–≤–∏–∫–∏': 3,
        '–ö—Ä–æ–∫—Å–∏': 4,
        'default': 10
      },
      popularBrands: [
        "Nike", "Adidas", "Puma", "New Balance", "Reebok", 
        "Asics", "Under Armour", "Converse", "Vans", "Jordan"
      ]
    };

    let allProducts = [];
    let filteredProducts = [];
    let selectedBrands = [];
    let selectedSizes = [];
    let selectedTypes = [];
    
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    let currentPage = 1;
    let itemsPerPage = 24;
    
    function toggleFilter(element) {
      const content = element.nextElementSibling;
      element.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    }

    function updateCounter(id, count) {
      const counter = document.getElementById(id);
      counter.textContent = count;
      counter.style.display = count > 0 ? 'inline-flex' : 'none';
    }

    function processImageUrl(originalUrl) {
      if (!originalUrl) return null;
      try {
        const url = new URL(originalUrl);
        if (url.hostname === '95.216.46.104') {
          return IMAGE_PROXY + encodeURIComponent(url.href);
        }
        return originalUrl;
      } catch {
        return null;
      }
    }

    function extractFirstPhoto(photoString) {
      if (!photoString) return null;
      const photos = photoString.split(';').map(url => url.trim()).filter(url => url.startsWith('http'));
      return photos.length > 0 ? photos[0] : null;
    }

    function formatPrice(price) {
      if (!price) return "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞";
      const numericPrice = parseFloat(price.toString().replace(/\s/g, '').replace(',', '.'));
      return isNaN(numericPrice) ? "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞" : `${numericPrice.toLocaleString('ru-RU')} ‚Ç¥`;
    }

    function cleanSize(size) {
      return (size || '').toString().replace(/EU/g, '').trim();
    }

    function isValidSize(size) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞–∑–º–µ—Ä - —á–∏—Å–ª–æ –∏ –Ω–µ –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ
      const numSize = parseFloat(size.replace(',', '.'));
      return !isNaN(numSize) && numSize >= MIN_SIZE;
    }

    function validateProduct(item) {
      if (!item || !item.name || !item.brand) return false;
      if (FILTER_CONFIG.excludedBrands.includes(item.brand.trim())) return false;
      const lowerName = item.name.toLowerCase();
      return !FILTER_CONFIG.excludedKeywords.some(keyword => lowerName.includes(keyword.toLowerCase()));
    }

    function compareSizes(a, b) {
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–∞–∑–º–µ—Ä—ã –≤ —á–∏—Å–ª–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
      const numA = parseFloat(a.replace(',', '.'));
      const numB = parseFloat(b.replace(',', '.'));
      
      // –ï—Å–ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è - —á–∏—Å–ª–∞, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
      if (!isNaN(numA) && !isNaN(numB)) {
        return numA - numB;
      }
      
      // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ - —á–∏—Å–ª–æ
      if (!isNaN(numA)) return -1;
      if (!isNaN(numB)) return 1;
      
      // –ï—Å–ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —á–∏—Å–ª–∞, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
      return a.localeCompare(b);
    }

    function sortBrands(brands) {
      return [...brands].sort((a, b) => {
        const isAPopular = FILTER_CONFIG.popularBrands.some(brand => 
          a.toLowerCase().includes(brand.toLowerCase()));
        const isBPopular = FILTER_CONFIG.popularBrands.some(brand => 
          b.toLowerCase().includes(brand.toLowerCase()));
        
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±—Ä–µ–Ω–¥—ã
        if (isAPopular && !isBPopular) return -1;
        if (!isAPopular && isBPopular) return 1;
        
        // –î–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –ø–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ popularBrands
        if (isAPopular && isBPopular) {
          const aIndex = FILTER_CONFIG.popularBrands.findIndex(brand => 
            a.toLowerCase().includes(brand.toLowerCase()));
          const bIndex = FILTER_CONFIG.popularBrands.findIndex(brand => 
            b.toLowerCase().includes(brand.toLowerCase()));
          return aIndex - bIndex;
        }
        
        // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
        return a.localeCompare(b);
      });
    }

    async function fetchSheet(sheetId, range) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data.values || [];
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error);
        return [];
      }
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
      const container = document.getElementById("pagination");
      const infoContainer = document.getElementById("paginationInfo");
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö
      const start = (currentPage - 1) * itemsPerPage + 1;
      const end = Math.min(currentPage * itemsPerPage, filteredProducts.length);
      infoContainer.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${filteredProducts.length > 0 ? start : 0}-${end} –∏–∑ ${filteredProducts.length} —Ç–æ–≤–∞—Ä–æ–≤`;
      
      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      let paginationHtml = '';
      
      // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
      paginationHtml += `<button class="pagination-arrow" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">‚ùÆ</button>`;
      
      // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
      paginationHtml += `<button class="${currentPage === 1 ? 'active' : ''}" onclick="changePage(1)">1</button>`;
      
      // –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
      let startPage = Math.max(2, currentPage - 2);
      let endPage = Math.min(totalPages - 1, currentPage + 2);
      
      // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∏–∑–∫–∞ –∫ –Ω–∞—á–∞–ª—É
      if (currentPage < 4) {
        endPage = Math.min(5, totalPages - 1);
      }
      
      // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∏–∑–∫–∞ –∫ –∫–æ–Ω—Ü—É
      if (currentPage > totalPages - 3) {
        startPage = Math.max(totalPages - 4, 2);
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–≥–æ—Ç–æ—á–∏—è –≤ –Ω–∞—á–∞–ª–µ
      if (startPage > 2) {
        paginationHtml += `<span>...</span>`;
      }
      
      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
      for (let i = startPage; i <= endPage; i++) {
        paginationHtml += `<button class="${currentPage === i ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–≥–æ—Ç–æ—á–∏—è –≤ –∫–æ–Ω—Ü–µ
      if (endPage < totalPages - 1 && totalPages > 1) {
        paginationHtml += `<span>...</span>`;
      }
      
      // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–µ—Å–ª–∏ –±–æ–ª—å—à–µ 1 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
      if (totalPages > 1) {
        paginationHtml += `<button class="${currentPage === totalPages ? 'active' : ''}" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }
      
      // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
      paginationHtml += `<button class="pagination-arrow" ${currentPage === totalPages || totalPages === 0 ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">‚ùØ</button>`;
      
      container.innerHTML = paginationHtml;
    }

    function changePage(page) {
      if (page < 1 || page > Math.ceil(filteredProducts.length / itemsPerPage)) return;
      currentPage = page;
      renderCatalog();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderCatalog() {
      const container = document.getElementById("catalog");
      
      if (!filteredProducts.length) {
        container.innerHTML = `<div class="error">üòê –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º</div>`;
        renderPagination();
        return;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const startIndex = (currentPage - 1) * itemsPerPage;
      const paginatedItems = filteredProducts.slice(startIndex, startIndex + itemsPerPage);
      
      container.innerHTML = paginatedItems.map(item => `
        <div class="item">
          <div class="item-img-container">
            <img src="${item.photo || 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII='}" alt="${item.name}">
          </div>
          <div class="item-content">
            <h3>${item.name}</h3>
            <div class="item-info"><strong>–ë—Ä–µ–Ω–¥:</strong> ${item.brand}</div>
            <div class="item-info"><strong>–¢–∏–ø:</strong> ${item.type}</div>
            <div class="item-info"><strong>–†–∞–∑–º–µ—Ä—ã:</strong></div>
            <div class="sizes">${item.sizes.map(size => `<span class="size">${size}</span>`).join('')}</div>
            <div class="price">${item.price}</div>
          </div>
        </div>
      `).join('');
      
      renderPagination();
    }

    function applyFilters() {
      selectedBrands = Array.from(document.querySelectorAll('#brandFilters input:checked')).map(el => el.value);
      selectedTypes = Array.from(document.querySelectorAll('#typeFilters input:checked')).map(el => el.value);
      selectedSizes = Array.from(document.querySelectorAll('#sizeFilters input:checked')).map(el => el.value);
      const query = document.getElementById('searchInput').value.toLowerCase();

      updateCounter('brandCounter', selectedBrands.length);
      updateCounter('typeCounter', selectedTypes.length);
      updateCounter('sizeCounter', selectedSizes.length);

      filteredProducts = allProducts.filter(item => {
        const matchesBrand = selectedBrands.length === 0 || selectedBrands.includes(item.brand);
        const matchesType = selectedTypes.length === 0 || selectedTypes.includes(item.type);
        const matchesSize = selectedSizes.length === 0 || item.sizes.some(size => selectedSizes.includes(size));
        const matchesName = item.name.toLowerCase().includes(query);
        return matchesBrand && matchesType && matchesSize && matchesName;
      });

      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É —Ç–∏–ø–æ–≤
      filteredProducts.sort((a, b) => {
        const getPriority = type => FILTER_CONFIG.typePriority[type] || FILTER_CONFIG.typePriority.default;
        return getPriority(a.type) - getPriority(b.type);
      });
      
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      currentPage = 1;
      renderCatalog();
    }

    function renderFilterCheckboxes(id, items, sortFunction = null) {
      const container = document.getElementById(id);
      const sortedItems = sortFunction ? sortFunction(items) : [...items].sort();
      
      if (id === 'brandFilters') {
        container.innerHTML = sortedItems.map(item => `
          <label class="${FILTER_CONFIG.popularBrands.some(brand => item.toLowerCase().includes(brand.toLowerCase())) ? 'popular-brand' : ''}">
            <input type="checkbox" value="${item}">${item}
          </label>
        `).join('');
      } else if (id === 'sizeFilters') {
        container.innerHTML = sortedItems.map(item => `
          <label>
            <input type="checkbox" value="${item}">${item}
          </label>
        `).join('');
      } else {
        container.innerHTML = sortedItems.map(item => `
          <label>
            <input type="checkbox" value="${item}">${item}
          </label>
        `).join('');
      }
      
      container.querySelectorAll('input').forEach(el => {
        el.addEventListener('change', applyFilters);
      });
    }

    async function loadCatalog() {
      try {
        const [shortData, longData] = await Promise.all([
          fetchSheet(SHEET_ID_SHORT, "TDSheet!A2:Z"),
          fetchSheet(SHEET_ID_LONG, "TDSheet!A2:Z")
        ]);

        const sizeMap = {}, priceMap = {};
        shortData.forEach(row => {
          const article = row[0]?.trim();
          const rawSize = cleanSize(row[1]);
          const price = row[2];
          
          if (article && rawSize && isValidSize(rawSize)) {
            if (!sizeMap[article]) sizeMap[article] = new Set();
            sizeMap[article].add(rawSize);
            
            const numPrice = parseFloat((price || '').replace(/\s/g, '').replace(',', '.'));
            if (!isNaN(numPrice)) {
              if (!priceMap[article] || numPrice < priceMap[article]) priceMap[article] = numPrice;
            }
          }
        });

        const brandSet = new Set(), typeSet = new Set(), sizeSet = new Set();
        const uniqueArticles = new Set();
        allProducts = [];

        longData.forEach(row => {
          const article = row[0]?.trim();
          const name = row[1]?.trim();
          const typeRaw = row[16]?.trim();
          const brand = row[15]?.trim();
          const photo = processImageUrl(extractFirstPhoto(row[23]));
          const longPrice = row[18];
          const type = typeRaw === '–í–∑—É—Ç—Ç—è' ? '–ö—Ä–æ—Å—ñ–≤–∫–∏' : typeRaw;

          if (!article || !name || typeRaw !== "–í–∑—É—Ç—Ç—è") return;
          if (uniqueArticles.has(article)) return;
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ —Ä–∞–∑–º–µ—Ä—ã >= MIN_SIZE
          if (!sizeMap[article] || sizeMap[article].size === 0) return;

          const sizes = sizeMap[article] ? Array.from(sizeMap[article]).sort(compareSizes) : [];
          const product = {
            article, name, brand: brand || "–ù–µ —É–∫–∞–∑–∞–Ω", type,
            photo, sizes, price: formatPrice(priceMap[article] || longPrice)
          };

          if (validateProduct(product)) {
            allProducts.push(product);
            uniqueArticles.add(article);
            if (product.brand) brandSet.add(product.brand);
            if (product.type) typeSet.add(product.type);
            product.sizes.forEach(s => sizeSet.add(s));
          }
        });
renderFilterCheckboxes("brandFilters", Array.from(brandSet), sortBrands);
        renderFilterCheckboxes("typeFilters", Array.from(typeSet).sort());
        renderFilterCheckboxes("sizeFilters", Array.from(sizeSet).sort(compareSizes));

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        updateCounter('brandCounter', 0);
        updateCounter('typeCounter', 0);
        updateCounter('sizeCounter', 0);

        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        document.querySelectorAll('.filter-title').forEach(title => {
          if (!title.classList.contains('collapsed')) {
            title.classList.add('collapsed');
            title.nextElementSibling.classList.add('collapsed');
          }
        });
        // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å—Ç—Ä (–ë—Ä–µ–Ω–¥—ã)
        const firstFilter = document.querySelector('.filter-title');
        if (firstFilter) {
          firstFilter.classList.remove('collapsed');
          firstFilter.nextElementSibling.classList.remove('collapsed');
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
        filteredProducts = [...allProducts];
        
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–∑ —Å–µ–ª–µ–∫—Ç–∞
        const itemsPerPageSelect = document.getElementById('itemsPerPage');
        itemsPerPage = parseInt(itemsPerPageSelect.value);
        
        applyFilters();
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–∞–ª–æ–≥–∞:", error);
        document.getElementById("catalog").innerHTML = `
          <div class="error">üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>
        `;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ URL
    function updateUrlParams() {
      const params = new URLSearchParams();
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±—Ä–µ–Ω–¥—ã
      if (selectedBrands.length > 0) {
        params.set('brands', selectedBrands.join(','));
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã
      if (selectedTypes.length > 0) {
        params.set('types', selectedTypes.join(','));
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
      if (selectedSizes.length > 0) {
        params.set('sizes', selectedSizes.join(','));
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
      const searchQuery = document.getElementById('searchInput').value;
      if (searchQuery) {
        params.set('q', searchQuery);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      params.set('page', currentPage.toString());
      params.set('perPage', itemsPerPage.toString());
      
      // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const newUrl = `${window.location.pathname}?${params.toString()}`;
      window.history.replaceState({}, '', newUrl);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function loadFromUrlParams() {
      const params = new URLSearchParams(window.location.search);
      
      // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      const page = parseInt(params.get('page'));
      if (page && !isNaN(page)) {
        currentPage = page;
      }
      
      const perPage = parseInt(params.get('perPage'));
      if (perPage && !isNaN(perPage)) {
        itemsPerPage = perPage;
        const itemsPerPageSelect = document.getElementById('itemsPerPage');
        if (itemsPerPageSelect) {
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ–ª–µ–∫—Ç
          for (let i = 0; i < itemsPerPageSelect.options.length; i++) {
            if (parseInt(itemsPerPageSelect.options[i].value) === perPage) {
              itemsPerPageSelect.selectedIndex = i;
              break;
            }
          }
        }
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
      const searchQuery = params.get('q');
      if (searchQuery) {
        document.getElementById('searchInput').value = searchQuery;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (—ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
      const brands = params.get('brands');
      if (brands) {
        selectedBrands = brands.split(',');
      }
      
      const types = params.get('types');
      if (types) {
        selectedTypes = types.split(',');
      }
      
      const sizes = params.get('sizes');
      if (sizes) {
        selectedSizes = sizes.split(',');
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    function applyStoredFilters() {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –±—Ä–µ–Ω–¥–æ–≤
      if (selectedBrands.length > 0) {
        const brandCheckboxes = document.querySelectorAll('#brandFilters input');
        brandCheckboxes.forEach(checkbox => {
          if (selectedBrands.includes(checkbox.value)) {
            checkbox.checked = true;
          }
        });
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã —Ç–∏–ø–æ–≤
      if (selectedTypes.length > 0) {
        const typeCheckboxes = document.querySelectorAll('#typeFilters input');
        typeCheckboxes.forEach(checkbox => {
          if (selectedTypes.includes(checkbox.value)) {
            checkbox.checked = true;
          }
        });
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã —Ä–∞–∑–º–µ—Ä–æ–≤
      if (selectedSizes.length > 0) {
        const sizeCheckboxes = document.querySelectorAll('#sizeFilters input');
        sizeCheckboxes.forEach(checkbox => {
          if (selectedSizes.includes(checkbox.value)) {
            checkbox.checked = true;
          }
        });
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
      applyFilters();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    document.getElementById("searchInput").addEventListener("input", () => {
      applyFilters();
      updateUrlParams();
    });
    
    document.getElementById("itemsPerPage").addEventListener("change", function() {
      itemsPerPage = parseInt(this.value);
      currentPage = 1; // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      renderCatalog();
      updateUrlParams();
    });

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ HTML
    window.changePage = function(page) {
      changePage(page);
      updateUrlParams();
    };
    
    window.toggleFilter = function(element) {
      toggleFilter(element);
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", () => {
      // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
      loadFromUrlParams();
      
      // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∞
      loadCatalog().then(() => {
        // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        applyStoredFilters();
      });
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    function setupLazyLoading() {
      if ('IntersectionObserver' in window) {
        const lazyImageObserver = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const lazyImage = entry.target;
              const src = lazyImage.dataset.src;
              if (src) {
                lazyImage.src = src;
                lazyImage.removeAttribute('data-src');
                lazyImageObserver.unobserve(lazyImage);
              }
            }
          });
        });

        // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –≤—Å–µ–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        document.querySelectorAll('.item img[data-src]').forEach((img) => {
          lazyImageObserver.observe(img);
        });
      } else {
        // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ IntersectionObserver
        document.querySelectorAll('.item img[data-src]').forEach((img) => {
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
        });
      }
    }

    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–ø–∏—Å–∫–∞
    function optimizeRendering() {
      // –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–Ω—ã –≤ —Ç–µ–∫—É—â–µ–º –æ–∫–Ω–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
      const catalogContainer = document.getElementById('catalog');
      const itemHeight = 300; // –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ (—Å –∑–∞–ø–∞—Å–æ–º)
      const viewportHeight = window.innerHeight;
      const visibleItems = Math.ceil(viewportHeight / itemHeight) + 5;
      
      // –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –±–æ–ª—å—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é
      if (filteredProducts.length > 100) {
        // –õ–æ–≥–∏–∫–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
        const totalHeight = filteredProducts.length * itemHeight;
        const scrollPosition = window.scrollY;
        
        // –í—ã—á–∏—Å–ª—è–µ–º, –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–∏–º—ã–º–∏
        const startIdx = Math.max(0, Math.floor(scrollPosition / itemHeight) - 5);
        const endIdx = Math.min(filteredProducts.length, startIdx + visibleItems + 10);
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
        const topSpacer = document.createElement('div');
        topSpacer.style.height = `${startIdx * itemHeight}px`;
        
        const bottomSpacer = document.createElement('div');
        bottomSpacer.style.height = `${(filteredProducts.length - endIdx) * itemHeight}px`;
        
        // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const visibleElements = filteredProducts.slice(startIdx, endIdx).map(item => {
          // –ö–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞...
        }).join('');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        catalogContainer.innerHTML = topSpacer.outerHTML + visibleElements + bottomSpacer.outerHTML;
      }
    }

    // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    const filterCache = {};
    
    function getCacheKey() {
      return `${selectedBrands.sort().join(',')}|${selectedTypes.sort().join(',')}|${selectedSizes.sort().join(',')}|${document.getElementById('searchInput').value}`;
    }
    
    function getCachedFilterResults() {
      const key = getCacheKey();
      return filterCache[key];
    }
    
    function setCachedFilterResults(results) {
      const key = getCacheKey();
      filterCache[key] = results;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
      const keys = Object.keys(filterCache);
      if (keys.length > 50) {
        delete filterCache[keys[0]];
      }
    }

    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    function optimizeImages() {
      document.querySelectorAll('.item img').forEach(img => {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç webp –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        if ('supports' in window && window.supports('webp')) {
          const originalSrc = img.src;
          if (originalSrc.includes('weserv.nl')) {
            img.src = originalSrc + '&output=webp';
          }
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç loading="lazy" –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–π –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        img.loading = 'lazy';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        img.onerror = function() {
          this.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=';
        };
      });
    }
  </script>
