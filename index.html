<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</title>
  <link rel="icon" href="data:,">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      display: flex;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∏–ª—å —Ç–æ—Ç –∂–µ ‚Äî –æ–±—Ä–µ–∑–∞–Ω –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ */

    .item {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      width: 220px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      cursor: pointer;
    }

    .item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 4px;
      background: #f5f5f5;
    }

    /* –°—Ç–∏–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
      background-color: #fff;
      margin: 40px auto;
      padding: 20px;
      max-width: 800px;
      border-radius: 8px;
      position: relative;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    .modal-images {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .modal-images img {
      max-width: 180px;
      border-radius: 6px;
    }

    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      color: #333;
      cursor: pointer;
    }

  </style>
</head>
<body>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2 id="modalTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h2>
    <div id="modalImages" class="modal-images"></div>
  </div>
</div>

<!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π HTML-–∫–∞—Ç–∞–ª–æ–≥ (–≤—ã—Ä–µ–∑–∞–Ω –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) -->

<script>
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalImages = document.getElementById('modalImages');
  const modalClose = document.querySelector('.modal-close');

  function showModal(product) {
    modalTitle.textContent = product.name;
    modalImages.innerHTML = product.allPhotos.map(url => `
      <img src="${url}" alt="${product.name}">
    `).join('');
    modal.style.display = 'block';
  }

  modalClose.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  window.addEventListener('click', e => {
    if (e.target === modal) modal.style.display = 'none';
  });

  // renderCatalog —Ñ—É–Ω–∫—Ü–∏—è:
  function renderCatalog(products) {
    const container = document.getElementById("catalog");
    if (!products.length) {
      container.innerHTML = `<div class="error">üòê –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º</div>`;
      return;
    }

    const sorted = [...products].sort((a, b) => {
      const getPriority = type => FILTER_CONFIG.typePriority[type] || FILTER_CONFIG.typePriority.default;
      return getPriority(a.type) - getPriority(b.type);
    });

    container.innerHTML = '';
    sorted.forEach(item => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <img src="${item.photo || 'data:image/png;base64,...'}" alt="${item.name}">
        <h3>${item.name}</h3>
        <p><strong>–ë—Ä–µ–Ω–¥:</strong> ${item.brand}</p>
        <p><strong>–¢–∏–ø:</strong> ${item.type}</p>
        <p><strong>–†–∞–∑–º–µ—Ä—ã:</strong></p>
        <div class="sizes">${item.sizes.map(size => `<span class="size">${size}</span>`).join('')}</div>
        <p class="price"><strong>–¶–µ–Ω–∞:</strong> ${item.price}</p>
      `;
      div.addEventListener('click', () => showModal(item));
      container.appendChild(div);
    });
  }

  // –û–±–Ω–æ–≤–∏–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–æ—Ç–æ
  function extractAllPhotos(photoString) {
    if (!photoString) return [];
    return photoString
      .split(';')
      .map(url => url.trim())
      .filter(url => url.startsWith('http'));
  }

  function processImageUrl(originalUrl) {
    if (!originalUrl) return null;
    try {
      const url = new URL(originalUrl);
      if (url.hostname === '95.216.46.104') {
        return IMAGE_PROXY + encodeURIComponent(url.href);
      }
      return originalUrl;
    } catch {
      return null;
    }
  }

  // –ü—Ä–∏–º–µ—Ä –≤ loadCatalog ‚Äî –¥–æ–±–∞–≤–∏–º allPhotos:
  const allPhotos = extractAllPhotos(row[23]).map(url => processImageUrl(url));
  const photo = allPhotos[0] || null;

  const product = {
    article,
    name,
    brand: brand || "–ù–µ —É–∫–∞–∑–∞–Ω",
    type,
    photo,
    allPhotos,
    sizes,
    price: formatPrice(priceMap[article] || longPrice)
  };
</script>
</body>
</html>
